<head>
    <meta charset="UTF-8">
    <title>execute converter</title>
</head>
<body>
    <p id="tester">test4</p>
    <label for="nbtfile">file:</label>
    <input type="file" name="nbtfile" id="nbtFile" />
    <script src="./pnbt.js"></script>
    <script>
        const nbt = require('prismarine-nbt');
        window.addEventListener('load',()=>{
            const input = document.getElementById('nbtFile');
            input.addEventListener('change',ev=>{
                inputFile = ev.target;
                const reader = new FileReader();
                reader.onload=()=>{
                    loadStructure(reader);
                    console.log("test");
                };
                reader.readAsArrayBuffer(input.files[0]);
            })
        })
        
        async function loadStructure(reader) {
            document.getElementById('tester').value = "loaded";
            let value;
            try {
                const { parsed } = await nbt.parse(Buffer.from(reader.result));
                value = JSON.stringify(parsed, null, 2);
            } catch(e) {}
            if(!value){
                let stru;
                try{
                    stru = nbt.writeUncompressed(JSON.parse(value),'little');
                }catch(e){
                    return;
                }
                const downloader = document.createElement('a');
                downloader.href = window.URL.createObjectURL(new Blob([stru]));
                downloader.download = document.getElementById('nbtFile').files[0].name;
                downloader.click();
            }
        }
    </script>
</body>
